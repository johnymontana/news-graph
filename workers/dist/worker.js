!function(t){var e={};function n(a){if(e[a])return e[a].exports;var o=e[a]={i:a,l:!1,exports:{}};return t[a].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=t,n.c=e,n.d=function(t,e,a){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:a})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(n.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(a,o,function(e){return t[e]}.bind(null,o));return a},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=1)}([function(t,e){t.exports={Router:({base:t="",routes:e=[]}={})=>({__proto__:new Proxy({},{get:(n,a,o)=>(n,...r)=>e.push([a.toUpperCase(),RegExp(`^${(t+n).replace(/(\/?)\*/g,"($1.*)?").replace(/\/$/,"").replace(/:(\w+)(\?)?(\.)?/g,"$2(?<$1>[^/]+)$2$3").replace(/\.(?=[\w(])/,"\\.")}/*$`),r])&&o}),routes:e,async handle(t,...n){let a,o,r=new URL(t.url);for(var[i,s,p]of(t.query=Object.fromEntries(r.searchParams),e))if((i===t.method||"ALL"===i)&&(o=r.pathname.match(s)))for(var c of(t.params=o.groups,p))if(void 0!==(a=await c(t.proxy||t,...n)))return a}})}},function(t,e,n){"use strict";n.r(e);var a=n(0);const o=Object(a.Router)(),r=({statement:t,parameters:e})=>{var n=new Headers;return n.append("Accept","application/json"),n.append("Content-Type","application/json"),n.append("Authorization",NEO4J_AUTH),{method:"POST",headers:n,body:JSON.stringify({statements:[{statement:t,parameters:e}]}),redirect:"follow"}};o.get("/",async(t,e)=>{var n={location:{latitude:t.cf.latitude||0,longitude:t.cf.longitude||0}};const a=await fetch(NEO4J_HTTP_URI,r({statement:"\n    MATCH (g:Geo) \n    WITH \n      distance(\n        g.location, \n        point({latitude: toFloat($location.latitude), longitude: toFloat($location.longitude)})\n      ) AS dist, g\n    ORDER BY dist ASC LIMIT 10\n    MATCH (a:Article)-[:ABOUT_GEO]->(g) WITH DISTINCT a ORDER BY a.published DESC\n    WITH COLLECT(\n      a {.*, articleId: id(a),\n        geos: [(a)-[:ABOUT_GEO]->(g:Geo) | g.name],  \n        topics: [(a)-[:HAS_TOPIC]->(t:Topic) | t.name], \n        orgs: [(a)-[:ABOUT_ORGANIZATION]->(o:Organization) | o.name], \n        people: [(a)-[:ABOUT_PERSON]->(p:Person) | p.name], \n        photos: [(a)-[:HAS_PHOTO]->(p:Photo) | {caption: p.caption, url: p.url}]\n      }) AS data\n    RETURN data",parameters:n})),o=await a.json();return new Response(JSON.stringify(o.results[0].data[0].row[0]),{status:200,headers:{"content-type":"application/json;charset=UTF-8"}})}),o.get("/recommended/:id",async({params:t})=>{var e={article:{id:decodeURIComponent(t.id)}};const n=await fetch(NEO4J_HTTP_URI,r({statement:"\n    MATCH (this:Article) WHERE id(this) = toInteger($article.id)\n    MATCH (this)-[:HAS_TOPIC|:ABOUT_GEO|:ABOUT_ORGANIZATION|:ABOUT_PERSON]->(t)\n    WITH * ORDER BY id(t)\n    WITH this, COLLECT(id(t)) AS t1\n    MATCH (a:Article)-[:HAS_TOPIC|:ABOUT_GEO|:ABOUT_ORGANIZATION|:ABOUT_PERSON]->(t) WHERE a <> this\n    WITH * ORDER BY id(t)\n    WITH this, a, t1, COLLECT(id(t)) AS t2\n    WITH a, gds.alpha.similarity.jaccard(t1, t2) AS jaccard\n    ORDER BY jaccard DESC LIMIT 10\n    RETURN COLLECT(a{.*, articleId: id(a),\n      geos: [(a)-[:ABOUT_GEO]->(g:Geo) | g.name],  \n      topics: [(a)-[:HAS_TOPIC]->(t:Topic) | t.name], \n      orgs: [(a)-[:ABOUT_ORGANIZATION]->(o:Organization) | o.name], \n      people: [(a)-[:ABOUT_PERSON]->(p:Person) | p.name], \n      photos: [(a)-[:HAS_PHOTO]->(p:Photo) | {caption: p.caption, url: p.url}]  \n      }) AS data",parameters:e})),a=await n.json();return new Response(JSON.stringify(a.results[0].data[0].row[0]),{status:200,headers:{"content-type":"application/json;charset=UTF-8"}})}),o.all("*",()=>new Response("404, not found!",{status:404})),addEventListener("fetch",t=>{t.respondWith(o.handle(t.request))})}]);